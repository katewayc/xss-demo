<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>XSS äº’å‹•æ•™å­¸å¯¦é©—å®¤</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --success: #27ae60;
            --bg: #f4f7f6;
        }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* ä»‹é¢ä½ˆå±€ */
        .main-container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; width: 100%; max-width: 1200px; }
        
        .panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; }
        
        /* å·¦å´ï¼šæ§åˆ¶å€ */
        .control-panel h2 { margin-top: 0; color: var(--primary); font-size: 1.2em; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .mode-selector { display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
        button.mode-btn { padding: 10px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; background: white; transition: 0.3s; text-align: left; }
        button.mode-btn.active { background: var(--accent); color: white; border-color: var(--accent); font-weight: bold; }
        
        .input-area textarea { width: 100%; height: 80px; padding: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; font-family: monospace; resize: none; margin-bottom: 10px; }
        .submit-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; font-weight: bold; }
        .submit-btn:hover { opacity: 0.9; }

        /* å³å´ï¼šå±•ç¤ºå€ */
        .display-panel { display: flex; flex-direction: column; gap: 20px; }
        svg { background: #fff; border-radius: 10px; border: 1px solid #eee; width: 100%; height: 300px; }
        
        /* å—å®³è€…ç€è¦½å™¨æ¨¡æ“¬ */
        .browser-mockup { border: 2px solid #ddd; border-top: 30px solid #ddd; border-radius: 8px; background: white; min-height: 150px; position: relative; }
        .browser-mockup::before { content: "å—å®³è€…çš„ç€è¦½å™¨è¦–çª— (Victim's View)"; position: absolute; top: -25px; left: 10px; font-size: 12px; color: #666; font-weight: bold; }
        .browser-content { padding: 15px; }

        /* å‹•ç•«å…ƒç´  */
        .flow-path { fill: none; stroke: #eee; stroke-width: 3; stroke-dasharray: 5; }
        .active-path { fill: none; stroke: var(--accent); stroke-width: 4; stroke-dasharray: 1000; stroke-dashoffset: 1000; }
        .particle { fill: var(--accent); display: none; filter: drop-shadow(0 0 3px red); }
        
        .exploit-flash { animation: flash 0.5s infinite; }
        @keyframes flash { 0% { background: white; } 50% { background: #ffcccc; } 100% { background: white; } }
        
        .hint-box { font-size: 0.85em; color: #666; background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 15px; }
    </style>
</head>
<body>

    <h1 style="color: var(--primary);">XSS äº’å‹•æ•™å­¸æ¼”ç¤º</h1>

    <div class="main-container">
        <div class="panel control-panel">
            <h2>1. é¸æ“‡æ”»æ“Šæ¨¡å¼</h2>
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('reflected', this)">åå°„å‹ (Reflected)</button>
                <button class="mode-btn" onclick="setMode('stored', this)">å„²å­˜å‹ (Stored)</button>
                <button class="mode-btn" onclick="setMode('dom', this)">DOM å‹ (DOM-based)</button>
            </div>

            <h2>2. è¼¸å…¥æ”»æ“Šè¼‰è· (Payload)</h2>
            <div class="input-area">
                <textarea id="payloadInput" placeholder="ä¾‹å¦‚: <img src=x onerror=alert('Hacked!')>"></textarea>
                <button class="submit-btn" onclick="executeAttack()">ç™¼å‹•æ”»æ“Šï¼</button>
            </div>

            <div class="hint-box" id="mode-hint">
                <strong>åå°„å‹æç¤ºï¼š</strong> æƒ¡æ„ä»£ç¢¼æœƒç¶“éä¼ºæœå™¨å¾Œï¼Œç«‹å³åå°„çµ¦ä½¿ç”¨è€…åŸ·è¡Œã€‚
            </div>
            
            <div style="margin-top:20px;">
                <strong>Checkmarx è¨ºæ–·ï¼š</strong>
                <p id="cx-result" style="font-size: 0.9em; color: var(--accent);">ç­‰å¾…æƒæè·¯å¾‘...</p>
            </div>
        </div>

        <div class="display-panel">
            <div class="panel">
                <svg id="visualMap" viewBox="0 0 800 300">
                    <path id="path-reflected" class="flow-path" d="M 100 200 Q 250 50 400 50 Q 550 50 700 200" />
                    <path id="path-stored" class="flow-path" d="M 100 200 Q 250 50 400 50 L 400 250 L 400 50 Q 550 50 700 200" />
                    <path id="path-dom" class="flow-path" d="M 100 220 L 700 220" />

                    <path id="anim-path" class="active-path" d="" />

                    <g transform="translate(60, 190)"> <circle cx="40" cy="30" r="30" fill="#fadbd8" stroke="#e74c3c" />
                        <text x="40" y="80" text-anchor="middle" font-size="12">é§­å®¢ (Source)</text>
                        <text x="40" y="38" text-anchor="middle" font-size="20">ğŸ˜ˆ</text>
                    </g>

                    <g transform="translate(360, 20)"> <rect width="80" height="60" rx="5" fill="#d6eaf8" stroke="#3498db" />
                        <text x="40" y="100" text-anchor="middle" font-size="12">ä¼ºæœå™¨ (Server)</text>
                    </g>

                    <g transform="translate(360, 240)"> <ellipse cx="40" cy="20" rx="40" ry="15" fill="#ebdef0" stroke="#9b59b6" />
                        <rect x="0" y="20" width="80" height="30" fill="#ebdef0" stroke="#9b59b6" />
                        <text x="40" y="70" text-anchor="middle" font-size="12">è³‡æ–™åº« (DB)</text>
                    </g>

                    <g transform="translate(660, 190)"> <circle cx="40" cy="30" r="30" fill="#d4efdf" stroke="#27ae60" />
                        <text x="40" y="80" text-anchor="middle" font-size="12">å—å®³è€… (Sink)</text>
                        <text x="40" y="38" text-anchor="middle" font-size="20">ğŸ‘¤</text>
                    </g>

                    <circle id="particle" class="particle" r="8" cx="0" cy="0" />
                </svg>
            </div>

            <div class="panel browser-mockup" id="browser-window">
                <div class="browser-content" id="output">
                    <p style="color: #999;">ç­‰å¾…æ”»æ“Šçµæœå‘ˆç¾...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'reflected';
        const hints = {
            reflected: "<strong>åå°„å‹æç¤ºï¼š</strong> è©¦è©¦è¼¸å…¥ <code>&lt;img src=x onerror=alert('XSS')&gt;</code>ã€‚é€™ç¨®æ”»æ“Šé€šå¸¸éš±è—åœ¨ URL é€£çµä¸­ã€‚",
            stored: "<strong>å„²å­˜å‹æç¤ºï¼š</strong> ä»£ç¢¼æœƒå­˜å…¥è³‡æ–™åº«ã€‚åœ¨çœŸå¯¦æ¡ˆä¾‹ä¸­ï¼Œä»»ä½•é€ è¨ªç•™è¨€æ¿çš„ä½¿ç”¨è€…éƒ½æœƒä¸­æ‹›ï¼",
            dom: "<strong>DOM å‹æç¤ºï¼š</strong> ç²’å­ç›´æ¥å¾é§­å®¢ç«¯è·³åˆ°ç€è¦½å™¨ã€‚æ³¨æ„ï¼šå®ƒå®Œå…¨ä¸ç¶“éä¼ºæœå™¨ï¼"
        };

        const cxInsights = {
            reflected: "Checkmarx åµæ¸¬åˆ°å¾ Request åˆ° Response çš„ä¸å®‰å…¨æ•¸æ“šæµã€‚é¢¨éšªï¼šé«˜ã€‚",
            stored: "Checkmarx ç™¼ç¾æ•¸æ“šæŒä¹…åŒ–å¾Œæœªç¶“éæ¿¾å³è¼¸å‡ºã€‚é¢¨éšªï¼šæ¥µé«˜ã€‚",
            dom: "Checkmarx é€éæƒæå®¢æˆ¶ç«¯ JSï¼Œç™¼ç¾ window.location è¢«è³¦å€¼çµ¦ innerHTMLã€‚é¢¨éšªï¼šé«˜ã€‚"
        };

        function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('mode-hint').innerHTML = hints[mode];
            document.getElementById('output').innerHTML = '<p style="color: #999;">ç­‰å¾…æ”»æ“Šçµæœå‘ˆç¾...</p>';
            document.getElementById('browser-window').classList.remove('exploit-flash');
            document.getElementById('cx-result').innerText = "ç­‰å¾…æƒæè·¯å¾‘...";
            document.getElementById('anim-path').setAttribute('d', '');
        }

        function executeAttack() {
            const input = document.getElementById('payloadInput').value;
            const particle = document.getElementById('particle');
            const animPath = document.getElementById('anim-path');
            const pathData = document.getElementById('path-' + currentMode).getAttribute('d');

            if (!input) { alert('è«‹è¼¸å…¥ Payloadï¼'); return; }

            // 1. æº–å‚™å‹•ç•«
            animPath.setAttribute('d', pathData);
            const totalLength = animPath.getTotalLength();
            animPath.style.strokeDasharray = totalLength;
            animPath.style.strokeDashoffset = totalLength;
            particle.style.display = 'block';

            // 2. åŸ·è¡Œ Checkmarx æƒææ¨¡æ“¬
            document.getElementById('cx-result').innerText = "æƒæä¸­... ğŸ”";
            
            // 3. å‹•ç•«éç¨‹
            let start = null;
            const duration = 2000;

            function step(timestamp) {
                if (!start) start = timestamp;
                const progress = (timestamp - start) / duration;

                if (progress < 1) {
                    const point = animPath.getPointAtLength(progress * totalLength);
                    particle.setAttribute('cx', point.x);
                    particle.setAttribute('cy', point.y);
                    animPath.style.strokeDashoffset = totalLength * (1 - progress);
                    requestAnimationFrame(step);
                } else {
                    completeAttack(input);
                }
            }
            requestAnimationFrame(step);
        }

        function completeAttack(payload) {
            document.getElementById('cx-result').innerText = cxInsights[currentMode];
            
            const outputArea = document.getElementById('output');
            const browserWindow = document.getElementById('browser-window');

            // æ¨¡æ“¬ XSS æ¼æ´ï¼šç›´æ¥ä½¿ç”¨ innerHTML æ¸²æŸ“
            outputArea.innerHTML = "<h4>æœå°‹çµæœ / ç•™è¨€å…§å®¹ï¼š</h4>" + payload;

            // æª¢æŸ¥æ˜¯å¦åŒ…å« script æ¨™ç±¤ (æ‰‹å‹•è§¸ç™¼ alert æ¨¡æ“¬)
            if (payload.includes('<script>') || payload.includes('onerror')) {
                browserWindow.classList.add('exploit-flash');
                setTimeout(() => {
                    alert('ã€æ¨¡æ“¬è­¦å‘Šã€‘XSS è…³æœ¬å·²åœ¨å—å®³è€…ç€è¦½å™¨åŸ·è¡Œï¼\nPayload: ' + payload);
                }, 100);
            }
        }
    </script>
</body>
</html>